# 概要设计文档

## 整体架构设计

### 系统架构
采用经典的三层架构，前后端分离设计：

```
┌─────────────────────────────────┐
│        前端层 (WebApp)           │
│     React + Ant Design         │
└─────────────────┬───────────────┘
                  │ HTTP API
┌─────────────────┴───────────────┐
│       后端层 (WebService)        │
│    Node.js + Express           │
└─────────────────┬───────────────┘
                  │ SQL
┌─────────────────┴───────────────┐
│        数据层 (DB)              │
│          SQLite                │
└─────────────────────────────────┘
```

## 技术栈选择

### 前端技术
- **React 18**: 主流前端框架，生态丰富，组件化开发
- **Ant Design**: 企业级UI组件库，开箱即用，快速开发
- **Axios**: HTTP客户端，处理API调用
- **React Router**: 单页应用路由管理

### 后端技术
- **Node.js**: JavaScript运行环境，前后端语言统一
- **Express**: 轻量级Web框架，简单易用
- **JWT**: 无状态认证，适合前后端分离架构
- **bcrypt**: 密码加密，保证安全性
- **multer**: 文件上传处理中间件

### 数据库选择
- **SQLite**:
  - 轻量级，零配置，适合小型应用
  - 文件数据库，便于备份和迁移
  - 支持标准SQL，性能满足需求

## 核心设计原则

### 1. 简单优先
- 避免过度设计，快速实现MVP
- 使用成熟的技术栈和组件库
- 优先实现核心功能

### 2. 模块化设计
- 前后端完全分离，便于独立开发和测试
- 功能模块化，便于扩展和维护
- 统一的API设计规范

### 3. 安全考虑
- JWT Token认证机制
- 密码加密存储
- 文件上传验证
- SQL注入防护

## 系统功能模块

### 用户模块
- 用户注册和登录
- Token认证管理
- 用户角色控制

### 文档模块
- 文档上传下载
- 文档列表管理
- 文档权限控制

### 搜索模块
- 关键词搜索
- 标签筛选
- 组合查询

### 管理模块
- 用户管理（管理员）
- 文档管理（管理员）
- 系统监控

## 数据流设计

### 用户认证流程
```
用户输入 → 前端验证 → 后端认证 → 生成Token → 返回前端 → 存储Token
```

### 文档操作流程
```
选择文件 → 前端验证 → 上传到后端 → 存储文件 → 记录数据库 → 返回结果
```

### 搜索查询流程
```
输入搜索条件 → 构建查询 → 数据库查询 → 过滤权限 → 返回结果
```

## API设计原则

### RESTful规范
- 使用标准HTTP动词（GET, POST, PUT, DELETE）
- 语义化的URL设计
- 统一的响应格式

### 接口版本管理
- URL路径包含版本号：`/api/v1/`
- 向后兼容原则

### 错误处理
- 统一的错误码规范
- 详细的错误信息
- 合理的HTTP状态码

## 部署架构

### 开发环境
- 前端：开发服务器（localhost:3000）
- 后端：Express服务器（localhost:3001）
- 数据库：本地SQLite文件

### 生产环境
- 前端：静态文件服务
- 后端：PM2进程管理
- 数据库：SQLite文件 + 定期备份

## 扩展性考虑

### 可扩展点
1. 数据库迁移到MySQL/PostgreSQL
2. 文件存储迁移到云存储
3. 添加Redis缓存层
4. 横向扩展支持

### 预留接口
- 第三方认证集成
- 文档预览功能
- 版本控制系统
- 工作流引擎

## 测试策略

### 测试方法
采用简化的测试驱动开发（Modified TDD），在快速开发的同时保证代码质量。

### 测试层次
```
优先级1：核心API测试（必须）
├── 认证接口测试
├── 文档CRUD测试
└── 权限验证测试

优先级2：关键组件测试（推荐）
├── 登录组件测试
├── 文件上传组件测试
└── 搜索组件测试

优先级3：集成测试（时间允许）
└── 端到端测试主要流程
```

### 测试工具
- **后端测试**：Jest + Supertest（API测试）
- **前端测试**：Jest + React Testing Library（组件测试）
- **E2E测试**：Cypress或Playwright（如果时间允许）
- **覆盖率目标**：核心功能60-70%

### 测试文件组织
```
backend/tests/
├── unit/           # 单元测试
├── integration/    # 集成测试
└── fixtures/       # 测试数据

frontend/src/
├── components/__tests__/  # 组件测试
└── services/__tests__/    # 服务测试
```

## 版本管理策略

### Git工作流
- **主分支**：main（稳定版本）
- **功能分支**：feature/功能名称
- **修复分支**：fix/问题描述
- **发布分支**：release/版本号

### 提交规范
采用语义化提交信息（Semantic Commit Messages）：
```
feat: 新增功能
fix: 修复问题
docs: 文档更新
style: 代码格式调整（不影响功能）
refactor: 代码重构
test: 测试相关
chore: 构建/配置相关
```

### 自动提交策略
开发过程中自动进行Git提交，保持清晰的开发历史：

**触发时机**：
1. 完成一个功能模块后
2. 修复一个bug后
3. 更新文档后
4. 完成每个开发阶段后

**提交示例**：
```bash
git add .
git commit -m "feat: 实现用户注册功能"
git commit -m "fix: 修复文件上传大小限制问题"
git commit -m "docs: 更新API接口文档"
```

### 版本标签
- **开发阶段标签**：v0.1-auth, v0.2-upload, v0.3-search
- **发布版本标签**：v1.0.0, v1.1.0, v2.0.0

## 约束和限制

### 技术约束
- 单机部署，不考虑分布式
- 文件存储在本地文件系统
- 数据库使用文件型SQLite

### 业务约束
- 用户数量限制：100人以内
- 并发用户：10-20人
- 文件大小：单个文件10MB以内
- 存储空间：总计10GB以内

---
**更新时间**：2025-09-20
**文档版本**：v1.1