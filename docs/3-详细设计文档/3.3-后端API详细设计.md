# 后端API详细设计文档

## 接口概览

所有API接口统一前缀：`/api`，返回JSON格式数据。

### 统一响应格式
```json
{
  "success": true|false,
  "data": {},
  "message": "操作描述"
}
```

### 认证方式
使用JWT Token，在请求头中携带：
```
Authorization: Bearer <token>
```

## 用户认证接口

### 用户注册
```
POST /api/auth/register
```

**请求参数**：
```json
{
  "username": "用户名",
  "email": "邮箱",
  "password": "密码"
}
```

**响应示例**：
```json
{
  "success": true,
  "data": {
    "id": 1,
    "username": "testuser",
    "email": "test@example.com",
    "role": "user"
  },
  "message": "注册成功"
}
```

### 用户登录
```
POST /api/auth/login
```

**请求参数**：
```json
{
  "email": "邮箱",
  "password": "密码"
}
```

**响应示例**：
```json
{
  "success": true,
  "data": {
    "token": "jwt_token_string",
    "user": {
      "id": 1,
      "username": "testuser",
      "email": "test@example.com",
      "role": "user"
    }
  },
  "message": "登录成功"
}
```

## 文档管理接口

### 文档上传
```
POST /api/documents
```

**请求类型**：`multipart/form-data`

**请求参数**：
- `file`: 文件（必需）
- `title`: 文档标题（必需）
- `description`: 文档描述（可选）
- `tags`: 标签，逗号分隔（可选）
- `is_public`: 是否公开，0|1（可选，默认0）

**响应示例**：
```json
{
  "success": true,
  "data": {
    "id": 1,
    "title": "项目文档",
    "description": "项目说明文档",
    "file_name": "project.pdf",
    "file_size": 1024000,
    "mime_type": "application/pdf",
    "tags": "项目,文档",
    "is_public": 0,
    "created_at": "2024-01-01 10:00:00"
  },
  "message": "上传成功"
}
```

### 文档列表
```
GET /api/documents
```

**查询参数**：
- `page`: 页码（可选，默认1）
- `limit`: 每页数量（可选，默认10）
- `search`: 搜索关键词（可选）
- `tags`: 标签筛选（可选）

**响应示例**：
```json
{
  "success": true,
  "data": {
    "documents": [
      {
        "id": 1,
        "title": "项目文档",
        "description": "项目说明文档",
        "file_name": "project.pdf",
        "file_size": 1024000,
        "upload_user": "testuser",
        "tags": "项目,文档",
        "is_public": 0,
        "created_at": "2024-01-01 10:00:00"
      }
    ],
    "total": 1,
    "page": 1,
    "limit": 10
  },
  "message": "获取成功"
}
```

### 文档下载
```
GET /api/documents/:id/download
```

**响应**：文件流

### 文档删除
```
DELETE /api/documents/:id
```

**响应示例**：
```json
{
  "success": true,
  "data": null,
  "message": "删除成功"
}
```

## 搜索接口

### 文档搜索
```
GET /api/search
```

**查询参数**：
- `keyword`: 搜索关键词（可选）
- `tags`: 标签筛选（可选）
- `page`: 页码（可选，默认1）
- `limit`: 每页数量（可选，默认10）

**响应示例**：
```json
{
  "success": true,
  "data": {
    "documents": [
      {
        "id": 1,
        "title": "项目文档",
        "description": "项目说明文档",
        "file_name": "project.pdf",
        "upload_user": "testuser",
        "tags": "项目,文档",
        "created_at": "2024-01-01 10:00:00"
      }
    ],
    "total": 1,
    "keyword": "项目",
    "tags": "文档"
  },
  "message": "搜索成功"
}
```

## 管理员接口

### 用户列表（管理员）
```
GET /api/admin/users
```

**权限要求**：管理员

**响应示例**：
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "username": "testuser",
      "email": "test@example.com",
      "role": "user",
      "created_at": "2024-01-01 10:00:00"
    }
  ],
  "message": "获取成功"
}
```

## 错误状态码

| 状态码 | 说明 |
|--------|------|
| 200 | 请求成功 |
| 400 | 请求参数错误 |
| 401 | 未认证或Token无效 |
| 403 | 权限不足 |
| 404 | 资源不存在 |
| 500 | 服务器内部错误 |

## 错误响应示例

```json
{
  "success": false,
  "data": null,
  "message": "用户名已存在"
}
```

## 文件上传限制

- **文件大小**：最大10MB
- **支持格式**：PDF、DOC、DOCX、TXT、PNG、JPG等
- **文件命名**：自动重命名避免冲突

---
**注意**：以上API为核心功能接口，保持简单实用。