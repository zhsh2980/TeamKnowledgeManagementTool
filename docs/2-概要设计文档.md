# 概要设计文档

## 整体架构设计

### 系统架构
采用经典的三层架构，前后端分离设计：

```
┌─────────────────────────────────┐
│        前端层 (WebApp)           │
│     React + Ant Design         │
└─────────────────┬───────────────┘
                  │ HTTP API
┌─────────────────┴───────────────┐
│       后端层 (WebService)        │
│    Node.js + Express           │
└─────────────────┬───────────────┘
                  │ SQL
┌─────────────────┴───────────────┐
│        数据层 (DB)              │
│          SQLite                │
└─────────────────────────────────┘
```

## 技术栈选择

### 前端技术
- **React 18**: 主流前端框架，生态丰富，组件化开发
- **Ant Design**: 企业级UI组件库，开箱即用，快速开发
- **Axios**: HTTP客户端，处理API调用
- **React Router**: 单页应用路由管理

### 后端技术
- **Node.js**: JavaScript运行环境，前后端语言统一
- **Express**: 轻量级Web框架，简单易用
- **JWT**: 无状态认证，适合前后端分离架构
- **bcrypt**: 密码加密，保证安全性
- **multer**: 文件上传处理中间件

### 数据库选择
- **SQLite**:
  - 轻量级，零配置，适合小型应用
  - 文件数据库，便于备份和迁移
  - 支持标准SQL，性能满足需求

## 核心设计原则

### 1. 简单优先
- 避免过度设计，快速实现MVP
- 使用成熟的技术栈和组件库
- 优先实现核心功能

### 2. 模块化设计
- 前后端完全分离，便于独立开发和测试
- 功能模块化，便于扩展和维护
- 统一的API设计规范

### 3. 安全考虑
- JWT Token认证机制
- 密码加密存储
- 文件上传验证
- SQL注入防护

## 系统功能模块

### 用户模块
- 用户注册和登录
- Token认证管理
- 用户角色控制

### 文档模块
- 文档上传下载
- 文档列表管理
- 文档权限控制

### 搜索模块
- 关键词搜索
- 标签筛选
- 组合查询

### 管理模块
- 用户管理（管理员）
- 文档管理（管理员）
- 系统监控

## 数据流设计

### 用户认证流程
```
用户输入 → 前端验证 → 后端认证 → 生成Token → 返回前端 → 存储Token
```

### 文档操作流程
```
选择文件 → 前端验证 → 上传到后端 → 存储文件 → 记录数据库 → 返回结果
```

### 搜索查询流程
```
输入搜索条件 → 构建查询 → 数据库查询 → 过滤权限 → 返回结果
```

## API设计原则

### RESTful规范
- 使用标准HTTP动词（GET, POST, PUT, DELETE）
- 语义化的URL设计
- 统一的响应格式

### 接口版本管理
- URL路径包含版本号：`/api/v1/`
- 向后兼容原则

### 错误处理
- 统一的错误码规范
- 详细的错误信息
- 合理的HTTP状态码

## 部署架构

### 开发环境
- 前端：开发服务器（localhost:3000）
- 后端：Express服务器（localhost:3001）
- 数据库：本地SQLite文件

### 生产环境
- 前端：静态文件服务
- 后端：PM2进程管理
- 数据库：SQLite文件 + 定期备份

## 扩展性考虑

### 可扩展点
1. 数据库迁移到MySQL/PostgreSQL
2. 文件存储迁移到云存储
3. 添加Redis缓存层
4. 横向扩展支持

### 预留接口
- 第三方认证集成
- 文档预览功能
- 版本控制系统
- 工作流引擎

## 代码规范

### JavaScript/React编码规范

#### 命名规范
- **组件名**：PascalCase（如 `DocumentCard`）
- **函数名**：camelCase（如 `getUserInfo`）
- **常量名**：UPPER_SNAKE_CASE（如 `MAX_FILE_SIZE`）
- **文件名**：组件用PascalCase，其他用camelCase
- **CSS类名**：kebab-case（如 `document-card`）

#### 代码风格
```javascript
// 优先使用函数组件和Hooks
const DocumentCard = ({ title, description }) => {
  const [loading, setLoading] = useState(false);

  // 使用解构赋值
  const { user, token } = useAuth();

  // 使用箭头函数
  const handleClick = () => {
    // 逻辑处理
  };

  return <div>{/* JSX内容 */}</div>;
};

// 导出方式统一
export default DocumentCard;
```

#### 文件组织
```
components/
  DocumentCard/
    index.js            // 导出入口
    DocumentCard.jsx    // 组件实现
    styles.module.css   // 样式文件
    utils.js           // 辅助函数
    __tests__/         // 测试文件
```

#### 注释规范
```javascript
/**
 * 文档卡片组件
 * @param {Object} props - 组件属性
 * @param {string} props.title - 文档标题
 * @param {Function} props.onDelete - 删除回调
 * @returns {React.Element} 文档卡片组件
 */
function DocumentCard({ title, onDelete }) {
  // TODO: 添加下载功能
  // FIXME: 修复删除权限判断

  // 复杂逻辑注释
  const canDelete = checkPermission();

  return <div>{/* 组件内容 */}</div>;
}
```

### 代码质量工具

#### ESLint配置
```json
{
  "extends": ["react-app", "prettier"],
  "rules": {
    "no-console": "warn",
    "prefer-const": "error",
    "react/prop-types": "off",
    "react-hooks/exhaustive-deps": "warn",
    "no-unused-vars": "warn"
  }
}
```

#### Prettier配置
```json
{
  "semi": true,
  "trailingComma": "es5",
  "singleQuote": true,
  "printWidth": 100,
  "tabWidth": 2
}
```

## UI设计规范

### 设计理念
采用**简约专业**的设计风格，强调内容的清晰展示和高效的信息传递。

### 色彩系统
```css
:root {
  /* 主色调 */
  --color-primary: #1890ff;        /* 科技蓝 */
  --color-primary-light: #40a9ff;  /* 浅蓝 */
  --color-primary-dark: #096dd9;   /* 深蓝 */

  /* 功能色 */
  --color-success: #52c41a;        /* 成功绿 */
  --color-warning: #faad14;        /* 警告橙 */
  --color-error: #ff4d4f;          /* 错误红 */
  --color-info: #1890ff;           /* 信息蓝 */

  /* 中性色 */
  --color-text-primary: #262626;   /* 主文本 */
  --color-text-secondary: #8c8c8c; /* 次要文本 */
  --color-text-disabled: #bfbfbf;  /* 禁用文本 */
  --color-border: #d9d9d9;         /* 边框 */
  --color-bg-gray: #f5f5f5;        /* 背景灰 */
  --color-bg-white: #ffffff;       /* 背景白 */
}
```

### 布局规范

#### 间距系统
```css
:root {
  --spacing-xs: 8px;   /* 超小间距 */
  --spacing-sm: 12px;  /* 小间距 */
  --spacing-md: 16px;  /* 中间距 */
  --spacing-lg: 24px;  /* 大间距 */
  --spacing-xl: 32px;  /* 超大间距 */
}
```

#### 响应式断点
```css
/* 移动设备 */
@media (max-width: 576px) { }

/* 平板设备 */
@media (min-width: 577px) and (max-width: 768px) { }

/* 小屏桌面 */
@media (min-width: 769px) and (max-width: 1200px) { }

/* 大屏桌面 */
@media (min-width: 1201px) { }
```

### 组件设计

#### 卡片组件
```css
.card {
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  background: white;
  padding: var(--spacing-lg);
}

.card:hover {
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
  transform: translateY(-2px);
}
```

#### 按钮样式
```css
.button-primary {
  height: 40px;
  padding: 0 24px;
  border-radius: 6px;
  font-size: 14px;
  font-weight: 500;
  transition: all 0.3s;
}
```

### Ant Design主题定制
```javascript
// theme.config.js
export const theme = {
  token: {
    // 基础样式
    colorPrimary: '#1890ff',
    borderRadius: 6,
    fontSize: 14,

    // 控件样式
    controlHeight: 40,
    controlHeightSM: 32,
    controlHeightLG: 48,

    // 颜色
    colorBgContainer: '#ffffff',
    colorBorder: '#d9d9d9',
    colorText: '#262626',
    colorTextSecondary: '#8c8c8c',

    // 动画
    motionUnit: 0.1,
    motionBase: 0,
    motionEaseInOut: 'cubic-bezier(0.4, 0, 0.2, 1)',
  },
  components: {
    Button: {
      primaryShadow: '0 2px 8px rgba(24, 144, 255, 0.2)',
    },
    Card: {
      paddingLG: 24,
      borderRadiusLG: 8,
    },
  },
};
```

### 交互规范

#### 加载状态
- 优先使用骨架屏，避免空白页面
- 局部加载不影响整体操作
- 加载时间超过1秒显示进度

#### 反馈机制
```javascript
// 成功反馈
message.success('操作成功');

// 错误反馈
Modal.error({
  title: '操作失败',
  content: '详细错误信息',
});

// 警告提示
notification.warning({
  message: '注意',
  description: '操作提示信息',
});
```

#### 动画规范
- 过渡时间：0.3s
- 缓动函数：cubic-bezier(0.4, 0, 0.2, 1)
- 避免过度动画，保持简洁
- 页面切换使用淡入淡出

### 页面布局模板
```
┌────────────────────────────────────┐
│  Logo    搜索框         用户菜单     │ 64px
├────────┬───────────────────────────┤
│        │                           │
│  侧边栏 │       主内容区             │ 自适应
│  200px │                           │
│        │                           │
└────────┴───────────────────────────┘
```

## 测试策略

### 测试方法
采用简化的测试驱动开发（Modified TDD），在快速开发的同时保证代码质量。

### 测试层次
```
优先级1：核心API测试（必须）
├── 认证接口测试
├── 文档CRUD测试
└── 权限验证测试

优先级2：关键组件测试（推荐）
├── 登录组件测试
├── 文件上传组件测试
└── 搜索组件测试

优先级3：集成测试（时间允许）
└── 端到端测试主要流程
```

### 测试工具
- **后端测试**：Jest + Supertest（API测试）
- **前端测试**：Jest + React Testing Library（组件测试）
- **E2E测试**：Cypress或Playwright（如果时间允许）
- **覆盖率目标**：核心功能60-70%

### 测试文件组织
```
backend/tests/
├── unit/           # 单元测试
├── integration/    # 集成测试
└── fixtures/       # 测试数据

frontend/src/
├── components/__tests__/  # 组件测试
└── services/__tests__/    # 服务测试
```

## 版本管理策略

### Git工作流
- **主分支**：main（稳定版本）
- **功能分支**：feature/功能名称
- **修复分支**：fix/问题描述
- **发布分支**：release/版本号

### 提交规范
采用语义化提交信息（Semantic Commit Messages）：
```
feat: 新增功能
fix: 修复问题
docs: 文档更新
style: 代码格式调整（不影响功能）
refactor: 代码重构
test: 测试相关
chore: 构建/配置相关
```

### 自动提交策略
开发过程中自动进行Git提交，保持清晰的开发历史：

**触发时机**：
1. 完成一个功能模块后
2. 修复一个bug后
3. 更新文档后
4. 完成每个开发阶段后

**提交示例**：
```bash
git add .
git commit -m "feat: 实现用户注册功能"
git commit -m "fix: 修复文件上传大小限制问题"
git commit -m "docs: 更新API接口文档"
```

### 版本标签
- **开发阶段标签**：v0.1-auth, v0.2-upload, v0.3-search
- **发布版本标签**：v1.0.0, v1.1.0, v2.0.0

## 约束和限制

### 技术约束
- 单机部署，不考虑分布式
- 文件存储在本地文件系统
- 数据库使用文件型SQLite

### 业务约束
- 用户数量限制：100人以内
- 并发用户：10-20人
- 文件大小：单个文件10MB以内
- 存储空间：总计10GB以内

---
**更新时间**：2025-09-20
**文档版本**：v1.2