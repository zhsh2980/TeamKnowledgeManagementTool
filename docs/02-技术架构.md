# 技术架构设计文档

## 1. 系统架构概述

### 1.1 整体架构
采用经典的三层架构模式：
- **表现层 (Presentation Layer)**: React前端应用
- **业务逻辑层 (Business Logic Layer)**: Node.js后端服务
- **数据访问层 (Data Access Layer)**: SQLite数据库

### 1.2 架构图
```
┌─────────────────────────────────────────────────────────┐
│                    前端层 (Frontend)                     │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐        │
│  │    React    │ │ TypeScript  │ │ Ant Design  │        │
│  │   Router    │ │   Redux     │ │   Axios     │        │
│  └─────────────┘ └─────────────┘ └─────────────┘        │
└─────────────────────────────────────────────────────────┘
                              │
                    HTTP/HTTPS RESTful API
                              │
┌─────────────────────────────────────────────────────────┐
│                   后端层 (Backend)                       │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐        │
│  │   Express   │ │     JWT     │ │   Multer    │        │
│  │    CORS     │ │   bcrypt    │ │   helmet    │        │
│  └─────────────┘ └─────────────┘ └─────────────┘        │
└─────────────────────────────────────────────────────────┘
                              │
                         SQL Queries
                              │
┌─────────────────────────────────────────────────────────┐
│                   数据层 (Database)                      │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐        │
│  │   SQLite    │ │  文件存储    │ │   备份策略   │        │
│  │   数据库     │ │   系统      │ │             │        │
│  └─────────────┘ └─────────────┘ └─────────────┘        │
└─────────────────────────────────────────────────────────┘
```

## 2. 技术栈选择

### 2.1 前端技术栈
| 技术 | 版本 | 用途 | 选择理由 |
|------|------|------|----------|
| React | 18.x | 前端框架 | 组件化、生态丰富、团队熟悉 |
| TypeScript | 5.x | 类型检查 | 提高代码质量、减少运行时错误 |
| Ant Design | 5.x | UI组件库 | 组件丰富、设计规范、开箱即用 |
| React Router | 6.x | 路由管理 | SPA路由解决方案 |
| Redux Toolkit | 1.x | 状态管理 | 可预测的状态管理 |
| Axios | 1.x | HTTP客户端 | 请求拦截、响应处理 |

### 2.2 后端技术栈
| 技术 | 版本 | 用途 | 选择理由 |
|------|------|------|----------|
| Node.js | 18.x | 运行环境 | 高性能、JavaScript全栈 |
| Express | 4.x | Web框架 | 轻量级、中间件丰富 |
| SQLite | 3.x | 数据库 | 轻量级、零配置、适合小型应用 |
| better-sqlite3 | 8.x | 数据库驱动 | 高性能、同步API |
| JWT | 9.x | 认证授权 | 无状态、跨域友好 |
| bcrypt | 5.x | 密码加密 | 安全的密码散列 |
| multer | 1.x | 文件上传 | 多部分表单数据处理 |
| helmet | 7.x | 安全中间件 | HTTP安全头设置 |
| cors | 2.x | 跨域处理 | CORS策略配置 |

### 2.3 开发工具
| 工具 | 用途 |
|------|------|
| Vite | 前端构建工具 |
| ESLint | 代码检查 |
| Prettier | 代码格式化 |
| Postman | API测试 |
| Git | 版本控制 |

## 3. 系统模块设计

### 3.1 前端模块结构
```
src/
├── components/           # 通用组件
│   ├── Layout/          # 布局组件
│   ├── Header/          # 头部导航
│   ├── Sidebar/         # 侧边栏
│   ├── FileUploader/    # 文件上传组件
│   ├── SearchBox/       # 搜索组件
│   ├── DocumentCard/    # 文档卡片
│   ├── TagManager/      # 标签管理
│   └── PermissionManager/ # 权限管理
├── pages/               # 页面组件
│   ├── Auth/           # 认证页面
│   ├── Dashboard/      # 仪表板
│   ├── Documents/      # 文档管理
│   ├── Search/         # 搜索结果
│   ├── Profile/        # 个人设置
│   └── Admin/          # 管理员页面
├── services/           # API服务
│   ├── authService.ts
│   ├── documentService.ts
│   ├── searchService.ts
│   └── userService.ts
├── store/              # 状态管理
│   ├── authSlice.ts
│   ├── documentSlice.ts
│   └── index.ts
├── types/              # 类型定义
├── utils/              # 工具函数
└── hooks/              # 自定义Hooks
```

### 3.2 后端模块结构
```
src/
├── controllers/        # 控制器
│   ├── authController.js
│   ├── documentController.js
│   ├── searchController.js
│   ├── tagController.js
│   └── userController.js
├── models/            # 数据模型
│   ├── User.js
│   ├── Document.js
│   ├── Tag.js
│   └── Permission.js
├── routes/            # 路由定义
│   ├── auth.js
│   ├── documents.js
│   ├── search.js
│   ├── tags.js
│   └── users.js
├── middleware/        # 中间件
│   ├── auth.js        # 认证中间件
│   ├── upload.js      # 文件上传中间件
│   ├── validation.js  # 数据验证中间件
│   └── errorHandler.js # 错误处理中间件
├── services/          # 业务服务
│   ├── authService.js
│   ├── documentService.js
│   ├── searchService.js
│   └── fileService.js
├── database/          # 数据库
│   ├── connection.js  # 数据库连接
│   ├── migrations/    # 数据库迁移
│   └── seeders/       # 初始数据
├── config/           # 配置文件
│   ├── database.js
│   ├── server.js
│   └── jwt.js
└── utils/            # 工具函数
    ├── logger.js
    ├── validator.js
    └── fileHelper.js
```

## 4. 数据流设计

### 4.1 用户认证流程
```
用户登录 → 前端发送认证请求 → 后端验证凭据 → 生成JWT Token
→ 返回Token → 前端存储Token → 后续请求携带Token → 后端验证Token
```

### 4.2 文档上传流程
```
选择文件 → 前端验证文件类型和大小 → 创建FormData → 发送上传请求
→ 后端验证权限 → 保存文件到服务器 → 保存文档信息到数据库 → 返回结果
```

### 4.3 搜索流程
```
输入搜索条件 → 前端发送搜索请求 → 后端解析搜索参数 → 查询数据库
→ 应用权限过滤 → 返回搜索结果 → 前端展示结果
```

## 5. 安全架构

### 5.1 认证机制
- JWT Token认证
- Token自动刷新机制
- 登录状态持久化

### 5.2 授权机制
- 基于角色的访问控制(RBAC)
- 资源级权限验证
- 中间件统一权限检查

### 5.3 数据安全
- 密码bcrypt加密
- SQL注入防护
- XSS攻击防护
- 文件上传安全检查

## 6. 性能架构

### 6.1 前端性能优化
- 组件懒加载
- 路由代码分割
- 图片懒加载
- 请求缓存策略

### 6.2 后端性能优化
- 数据库索引优化
- 查询结果缓存
- 文件流式传输
- 压缩中间件

### 6.3 数据库优化
- 合理的表结构设计
- 索引策略
- 查询优化
- 连接池管理

## 7. 可扩展性设计

### 7.1 水平扩展考虑
- 无状态服务设计
- 数据库连接池
- 文件存储抽象
- 配置外部化

### 7.2 垂直扩展考虑
- 模块化设计
- 插件架构预留
- API版本控制
- 数据库迁移机制

## 8. 监控和日志

### 8.1 应用监控
- 系统性能指标
- 用户行为统计
- 错误率监控
- API响应时间

### 8.2 日志系统
- 分级日志记录
- 操作审计日志
- 错误日志收集
- 日志轮转策略

## 9. 部署架构

### 9.1 单机部署
```
┌─────────────────────────────────┐
│         部署服务器               │
│                                │
│  ┌─────────────┐                │
│  │   Nginx     │ (反向代理)      │
│  └─────────────┘                │
│         │                      │
│  ┌─────────────┐                │
│  │   Node.js   │ (后端服务)      │
│  │   Express   │                │
│  └─────────────┘                │
│         │                      │
│  ┌─────────────┐                │
│  │   SQLite    │ (数据库)       │
│  └─────────────┘                │
│                                │
│  ┌─────────────┐                │
│  │ 文件存储     │ (上传文件)      │
│  └─────────────┘                │
└─────────────────────────────────┘
```

### 9.2 开发环境
- 前后端分离开发
- 热重载支持
- 开发数据库
- Mock数据支持

## 10. 技术决策记录

### 10.1 为什么选择SQLite？
- **优点**: 轻量级、零配置、文件数据库、适合小团队
- **缺点**: 并发性能限制、不支持网络访问
- **决策**: 符合项目需求，团队规模小，维护成本低

### 10.2 为什么选择JWT？
- **优点**: 无状态、跨域支持、移动端友好
- **缺点**: Token较大、无法主动失效
- **决策**: 符合前后端分离架构，便于扩展

### 10.3 为什么选择本地文件存储？
- **优点**: 简单直接、成本低、便于备份
- **缺点**: 扩展性有限、无CDN支持
- **决策**: 项目初期适用，后续可扩展至云存储